var __reflect=this&&this.__reflect||function(t,i,e){t.__class__=i,e?e.push(i):e=[i],t.__types__=t.__types__?e.concat(t.__types__):e},__extends=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var a in i)i.hasOwnProperty(a)&&(t[a]=i[a]);e.prototype=i.prototype,t.prototype=new e},RCustom;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.IsVertical=!0,t.LastStartTime=0,t.FreamTime=0,t.numParticles=0,t.pool=[],t.particles=[],t.ScaleAdjust_Weights=[],t.ScaleAdjust_Values=[],t.totalTime=0,t.timeMul=1,t.IsSendTimeEvent=!1,t.lstEventTime=[],t.lstEventName=[],t.touchEnabled=!1,t.touchChildren=!1,t.visible=!1,t.display=new egret.DisplayObjectContainer,t.display.touchEnabled=!1,t.display.touchChildren=!1,t.addChild(t.display),t}return __extends(e,i),e.prototype.Test=function(){console.log("..............................................")},e.prototype.initConfig=function(i){this.Test();var e=this.ConversionJson(i);if(this.Config=e,this.emissionRate=e.ParticeSystemEmissionRate,this.timeMul=e.ParticeSystemPlayTimeMul,this.totalTime=e.ParticeSystemPlayTime,this.x=e.ParticeSystemLocation_X,this.y=e.ParticeSystemLocation_Y,this.emitterX=e.ParticeEmitter_X,this.emitterY=e.ParticeEmitter_Y,this.Path_Mode=e.ParticleIsSystemPathMode,1==e.ParticleIsSystemPathMode){this.Path_Cycle=e.ParticlePathCycle,this.Path_Speed=e.ParticlePathSpeed;for(var a=e.ParticlePathWaypoints,s=a.length,o=[],r=0;s>r;r++){var n=new t.ParticlePoint;n.x=a[r][0],n.y=a[r][1],o[r]=n}this.Path_Waypoints=o}this.ScaleAdjust_Weights=t.ParticleMath.getDistribution_Weights(e.ParticeScaleAdjust_SD,e.ParticeScaleAdjust_Size),this.ScaleAdjust_Values=t.ParticleMath.getDistribution_Values(e.ParticeScaleAdjust_Min,e.ParticeScaleAdjust_Max,this.ScaleAdjust_Weights);for(var h=RES.getRes(e.ParticeSystemMovieClipData+"_json"),c=RES.getRes(e.ParticeSystemMovieClipData+"_png"),l=new egret.MovieClipDataFactory(h,c),p=[],P=3*this.emissionRate,u=this.display,r=0;P>r;r++){var _=new t.Particle;_.mInit(l.generateMovieClipData(),u),p.push(_)}this.pool=p,this.mcFactory=l},e.prototype.ConversionJson=function(i){var e=new t.ParticleSetting;return e.setConfig(i),e},e.prototype.start=function(t){if(void 0===t&&(t=this.Config.ParticeSystemPlayTime),null==this.Config)throw Error("Config Data is null. please init first");this.stop(),this.visible=!0,this.totalTime=t,this.NowPlayTime=0,egret.startTick(this.countTime,this),this.timeStamp=egret.getTimer(),1==this.Path_Mode&&this.preProcessPath(),this.IsSendTimeEvent=this.Config.ParticleIsEventType,1==this.IsSendTimeEvent&&(this.lstEventTime=this.Config.ParticleEventTime,this.lstEventName=this.Config.ParticleEventName),this.FreamTime=0,this.LastStartTime=egret.getTimer(),this.IntervalCode=egret.setInterval(this.update,this,1e3/this.emissionRate)},e.prototype.countTime=function(t){var i=t-this.timeStamp;this.timeStamp=t,this.NowPlayTime+=i,-1!=this.totalTime&&(this.totalTime-=i,this.totalTime<0&&(this.totalTime=0));for(var e,a=0,s=this.particles,o=i*this.timeMul;a<this.numParticles;)e=s[a],e.currentTime<e.totalTime?(e.mUpdate(o),e.currentTime+=o,a++):this.removeParticle(e);if(1==this.IsSendTimeEvent){for(var r=this.lstEventTime.length,n=this.lstEventName,h=this.lstEventTime,c=this.NowPlayTime,l=0;r>l;l++){var p=h[l];c>p&&(EventSystem.on_event(eEvent.on_particles_event,this,n[l]),h.splice(l,1),n.splice(l,1))}0==r&&(this.IsSendTimeEvent=!1)}return 0==this.totalTime&&(egret.clearInterval(this.IntervalCode),EventSystem.on_event(eEvent.on_particles_stop,this)),0==this.numParticles&&0==this.totalTime&&(this.visible=!1,egret.stopTick(this.countTime,this),EventSystem.on_event(eEvent.on_particles_done,this)),!1},e.prototype.update=function(){var t=egret.getTimer(),i=1e3/this.emissionRate,e=t-this.LastStartTime;if(this.LastStartTime=t,-1==this.totalTime||this.totalTime>0)for(this.offsetTime=0,this.FreamTime+=e;this.FreamTime>0;)this.addOneParticle(),this.FreamTime-=i;return!1},e.prototype.stop=function(t){void 0===t&&(t=!1),egret.clearInterval(this.IntervalCode),1==t&&(this.visible=!1,this.clear(),egret.stopTick(this.countTime,this))},e.prototype.addOneParticle=function(){var t=this.getParticle();0==this.Path_Mode?t.mStart(this.Config,this.getStartPostition(),this.ScaleAdjust_Weights,this.ScaleAdjust_Values):(t.mStart(this.Config,this.getNextPathPosition(this.offsetTime),this.ScaleAdjust_Weights,this.ScaleAdjust_Values),this.offsetTime+=1e3/this.emissionRate),this.particles.push(t),this.numParticles++},e.prototype.getParticle=function(){var i;return this.pool.length>0?i=this.pool.pop():(i=new t.Particle,i.mInit(this.mcFactory.generateMovieClipData(),this.display)),i},e.prototype.getStartPostition=function(){var i=this.emitterX,e=this.emitterY,a={x:t.ParticleMath.getRandom(-i,i),y:t.ParticleMath.getRandom(-e,e)};return a},e.prototype.removeParticle=function(t){var i=this.particles.indexOf(t);-1!=i&&(t.mStop(),this.particles.splice(i,1),this.pool.push(t),this.numParticles--)},e.prototype.clear=function(){for(var t=this.particles,i=t.length,e=0;i>e;e++)this.removeParticle(t[0]);this.numParticles=0},e.prototype.preProcessPath=function(){for(var t=this.Path_Waypoints,i=t[0],e=0,a=t.length,s=1;a>s;s++){var o=t[s];o.index=s,o.spanDistance=this.calcnDistance(i,o),e+=o.spanDistance,o.totalDistance=e,i=o}var r=t[0],n=this.calcnDistance(r,t[a-1]);e+=n,this.TotalPathDistance=e,r.index=0,r.totalDistance=e,r.spanDistance=n},e.prototype.calcnDistance=function(t,i){var e=t.x-i.x,a=t.y-i.y;return Math.sqrt(e*e+a*a)},e.prototype.getNextPathPosition=function(t){var i=this.Path_Waypoints,e=i.length,a=this.NowPlayTime+t,s=a*this.Path_Speed*20;0==this.Path_Cycle&&s>i[e-1].totalDistance-10&&egret.clearInterval(this.IntervalCode),s=this.normalize(s,this.TotalPathDistance);for(var o=e-1,r=o;r>=1&&!(s>i[r].totalDistance);r--);var n=i[r];++r>=e&&(r=0);var h=i[r],c=1-(h.totalDistance-s)/h.spanDistance,l={x:n.x+(h.x-n.x)*c,y:n.y+(h.y-n.y)*c};return l},e.prototype.normalize=function(t,i){if(0>t)for(;0>t;)t+=i;else if(t>i)for(;t>i;)t-=i;return t},e.prototype.setEmissionRate=function(t){this.stop(!0),this.Config.ParticeSystemEmissionRate=t,this.emissionRate=t,this.start()},e.prototype.setPlayTime=function(t){this.stop(!0),this.Config.ParticeSystemPlayTime=1e3*t,this.totalTime=1e3*t,this.start()},e.prototype.setPlayTimeMul=function(t){this.stop(!0),this.Config.ParticeSystemPlayTimeMul=t/100,this.timeMul=t/100,this.start()},e.prototype.setLocation_X=function(t){this.stop(!0);var i=this.IsVertical?360:640;this.Config.ParticeSystemLocation_X=t+i,this.x=t+i,this.start()},e.prototype.setLocation_Y=function(t){this.stop(!0);var i=this.IsVertical?640:360;this.Config.ParticeSystemLocation_Y=t+i,this.y=t+i,this.start()},e.prototype.setEmitter_X=function(t){this.stop(!0),this.Config.ParticeEmitter_X=t,this.emitterX=t,this.start()},e.prototype.setEmitter_Y=function(t){this.stop(!0),this.Config.ParticeEmitter_Y=t,this.emitterY=t,this.start()},e.prototype.setGravity_X=function(t){this.stop(!0),this.Config.ParticeGravity_X=t/1e3,this.start()},e.prototype.setGravity_Y=function(t){this.stop(!0),this.Config.ParticeGravity_Y=t/1e3,this.start()},e.prototype.setSaveTime_Min=function(t){this.stop(!0),this.Config.ParticeSaveTime_Min=1e3*t,this.start()},e.prototype.setSaveTime_Max=function(t){this.stop(!0),this.Config.ParticeSaveTime_Max=1e3*t,this.start()},e.prototype.setBleanModeType=function(t){this.stop(!0),this.Config.ParticeBleanModeType=t,this.start()},e.prototype.setIsRandomFrame=function(t){this.stop(!0),this.Config.ParticeIsRandomFrame=t,this.start()},e.prototype.setFireSpeed_Min=function(t){this.stop(!0),this.Config.ParticeFireSpeed_Min=t/100,this.start()},e.prototype.setFireSpeed_Max=function(t){this.stop(!0),this.Config.ParticeFireSpeed_Max=t/100,this.start()},e.prototype.setDrag=function(t){this.stop(!0),this.Config.ParticeDrag=t/1e6,this.start()},e.prototype.setDirection_Min=function(t){this.stop(!0),this.Config.ParticeDirection_Min=t,this.start()},e.prototype.setDirection_Max=function(t){this.stop(!0),this.Config.ParticeDirection_Max=t,this.start()},e.prototype.setScale_Min=function(t){this.stop(!0),this.Config.ParticeScale_Min=t/100,this.start()},e.prototype.setScale_Max=function(t){this.stop(!0),this.Config.ParticeScale_Max=t/100,this.start()},e.prototype.setScaleAdjust_Min=function(i){this.stop(!0),this.Config.ParticeScaleAdjust_Min=i/100,this.ScaleAdjust_Values=t.ParticleMath.getDistribution_Values(i/100,this.Config.ParticeScaleAdjust_Max,this.ScaleAdjust_Weights),this.start()},e.prototype.setScaleAdjust_Max=function(i){this.stop(!0),this.Config.ParticeScaleAdjust_Max=i/100,this.ScaleAdjust_Values=t.ParticleMath.getDistribution_Values(this.Config.ParticeScaleAdjust_Min,i/100,this.ScaleAdjust_Weights),this.start()},e.prototype.setScaleAdjust_Size=function(i){this.stop(!0),this.Config.ParticeScaleAdjust_Size=i,this.ScaleAdjust_Weights=t.ParticleMath.getDistribution_Weights(this.Config.ParticeScaleAdjust_SD,i),this.ScaleAdjust_Values=t.ParticleMath.getDistribution_Values(this.Config.ParticeScaleAdjust_Min,this.Config.ParticeScaleAdjust_Max,this.ScaleAdjust_Weights),this.start()},e.prototype.setScaleAdjust_SD=function(i){this.stop(!0),this.Config.ParticeScaleAdjust_SD=i,this.ScaleAdjust_Weights=t.ParticleMath.getDistribution_Weights(i,this.Config.ParticeScaleAdjust_Size),this.ScaleAdjust_Values=t.ParticleMath.getDistribution_Values(this.Config.ParticeScaleAdjust_Min,this.Config.ParticeScaleAdjust_Max,this.ScaleAdjust_Weights),this.start()},e.prototype.setRotation_Min=function(t){this.stop(!0),this.Config.ParticleRotation_Min=t,this.start()},e.prototype.setRotation_Max=function(t){this.stop(!0),this.Config.ParticleRotation_Max=t,this.start()},e.prototype.setRotationSpeed_Min=function(t){this.stop(!0),this.Config.ParticleRotationSpeed_Min=t,this.start()},e.prototype.setRotationSpeed_Max=function(t){this.stop(!0),this.Config.ParticleRotationSpeed_Max=t,this.start()},e.prototype.setStartAlpha_Min=function(t){this.stop(!0),this.Config.ParticleStartAlpha_Min=t/100,this.start()},e.prototype.setStartAlpha_Max=function(t){this.stop(!0),this.Config.ParticleStartAlpha_Max=t/100,this.start()},e.prototype.setEndAlpha_Min=function(t){this.stop(!0),this.Config.ParticleEndAlpha_Min=t/100,this.start()},e.prototype.setEndAlpha_Max=function(t){this.stop(!0),this.Config.ParticleEndAlpha_Max=t/100,this.start()},e.prototype.setIsSystemPathMode=function(i){if(this.stop(!0),this.Path_Mode=i,i){this.Path_Cycle=this.Config.ParticlePathCycle,this.Path_Speed=this.Config.ParticlePathSpeed;for(var e=this.Config.ParticlePathWaypoints,a=e.length,s=[],o=0;a>o;o++){var r=new t.ParticlePoint;r.x=e[o][0],r.y=e[o][1],s[o]=r}this.Path_Waypoints=s}this.start()},e.prototype.setPathCycle=function(t){this.stop(!0),this.Path_Cycle=t,this.start()},e.prototype.setPathSpeed=function(t){this.stop(!0),this.Path_Speed=t,this.start()},e.prototype.setPathWaypoints_Add=function(i,e){this.stop(!0);var a=new t.ParticlePoint;a.x=i,a.y=e,this.Path_Waypoints.push(a),this.start()},e.prototype.setPathWaypoints_Edit=function(t,i,e){this.stop(!0),this.Path_Waypoints[e].x=t,this.Path_Waypoints[e].y=i,this.start()},e.prototype.setPathWaypoints_Remove=function(t){this.stop(!0);for(var i=new Array,e=0;e<this.Path_Waypoints.length;e++)e!=t&&i.push(this.Path_Waypoints[e]);this.Path_Waypoints=i,this.start()},e}(egret.DisplayObjectContainer);t.ParticeSystem=i,__reflect(i.prototype,"RCustom.ParticeSystem")}(RCustom||(RCustom={}));var RCustom;!function(t){var i=function(i){function e(){var t=i.call(this)||this;return t.totalTime=0,t.currentTime=0,t.NowGravity_X=0,t.NowGravity_Y=0,t.touchEnabled=!1,t}return __extends(e,i),e.prototype.mInit=function(t,i){this.parent!=i&&(this.parentStage=i,i.addChild(this)),this.movieClipData!=t&&(this.movieClipData=t,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2),this.visible=!1},e.prototype.mStart=function(i,e,a,s){var o=this;if(o.currentTime=0,o.NowGravity_X=0,o.NowGravity_Y=0,o.visible=!0,o.x=e.x,o.y=e.y,o.Config=i,o.blendMode=i.ParticeBleanModeType,1==i.ParticeIsRandomFrame){var r=Math.floor(Math.random()*o.$totalFrames);o.gotoAndPlay(r,-1)}else o.play(-1);o.Gravity_X=i.ParticeGravity_X,o.Gravity_Y=i.ParticeGravity_Y,o.Drag=i.ParticeDrag,o.totalTime=t.ParticleMath.getRandom(i.ParticeSaveTime_Min,i.ParticeSaveTime_Max);var n=t.ParticleMath.getRandom(i.ParticeDirection_Min,i.ParticeDirection_Max);o.velocityX=Math.sin(Math.PI/180*n),o.velocityY=-Math.cos(Math.PI/180*n),o.velocity=t.ParticleMath.getRandom(i.ParticeFireSpeed_Min,i.ParticeFireSpeed_Max),o.scaleX=o.scaleY=t.ParticleMath.getRandom(i.ParticeScale_Min,i.ParticeScale_Max),o.ScaleAdjust=t.ParticleMath.getWeightsValue(a,s),o.alpha=t.ParticleMath.getRandom(i.ParticleStartAlpha_Min,i.ParticleStartAlpha_Max),o.EndAlpha=t.ParticleMath.getRandom(i.ParticleEndAlpha_Min,i.ParticleEndAlpha_Max),o.AlphaDelta=(o.EndAlpha-o.alpha)/o.totalTime,o.rotation=t.ParticleMath.getRandom(i.ParticleRotation_Min,i.ParticleRotation_Max),o.RotationSpeed=t.ParticleMath.getRandom(i.ParticleRotationSpeed_Min,i.ParticleRotationSpeed_Max)},e.prototype.mUpdate=function(t){var i=this;return i.x+=i.velocityX*i.velocity*t,i.y+=i.velocityY*i.velocity*t,i.NowGravity_X+=i.Gravity_X*t,i.NowGravity_Y+=i.Gravity_Y*t,i.x+=i.NowGravity_X*t,i.y+=i.NowGravity_Y*t,i.scaleX*=i.ScaleAdjust,i.scaleY*=i.ScaleAdjust,i.alpha+=i.AlphaDelta*t,i.rotation+=i.RotationSpeed*t,i.velocity>0&&(i.velocity-=i.Drag*t),i.scaleX<.05?void i.mStop():void 0},e.prototype.mStop=function(){this.visible=!1},e.prototype.checkVisible=function(){},e}(egret.MovieClip);t.Particle=i,__reflect(i.prototype,"RCustom.Particle")}(RCustom||(RCustom={}));var RCustom;!function(t){var i=function(){function t(){}return t.getRandom=function(t,i){return Math.random()*(i-t)+t},t.getDistribution_Weights=function(t,i){var e=[];if(0==t)return e.push(50),e;for(var a=i/2,s=t/a,o=a-1,r=0;o>r;r++){var n=a-r,h=s*n;e.push(50-h)}e.push(50);for(var c=i-1,r=a;c>r;r++){var n=r-a+1,h=s*n;e.push(50+h)}return e},t.getDistribution_Values=function(t,i,e){for(var a=i-t,s=e.length,o=a/s,r=[],n=0;s>n;n++)r.push(t+n*o);return r},t.getWeightsValue=function(t,i){for(var e=t.length,a=0,s=0;e>s;s++)a+=t[s];var o=this.getRandom(0,a);a=0;for(var s=0;e>s;s++)if(a+=t[s],a>o)return i[s];return i[s-1]},t}();t.ParticleMath=i,__reflect(i.prototype,"RCustom.ParticleMath")}(RCustom||(RCustom={}));var RCustom;!function(t){var i=function(){function t(){}return t}();t.ParticlePoint=i,__reflect(i.prototype,"RCustom.ParticlePoint")}(RCustom||(RCustom={}));var RCustom;!function(t){var i=function(){function t(){this.ParticeSystemMovieClipData="null",this.ParticeSystemEmissionRate=-1,this.ParticeSystemPlayTime=-1,this.ParticeSystemPlayTimeMul=-1,this.ParticeSystemLocation_X=-1,this.ParticeSystemLocation_Y=-1,this.ParticeBleanModeType="",this.ParticeIsRandomFrame=!1,this.ParticeIsAutoFixVisible=!1,this.ParticeEmitter_X=-1,this.ParticeEmitter_Y=-1,this.ParticeGravity_X=-1,this.ParticeGravity_Y=-1,this.ParticeSaveTime_Min=-1,this.ParticeSaveTime_Max=-1,this.ParticeDirection_Min=-1,this.ParticeDirection_Max=-1,this.ParticeFireSpeed_Min=-1,this.ParticeFireSpeed_Max=-1,this.ParticeDrag=-1,this.ParticeScale_Min=-1,this.ParticeScale_Max=-1,this.ParticeScaleAdjust_Min=-1,this.ParticeScaleAdjust_Max=-1,this.ParticeScaleAdjust_SD=-1,this.ParticeScaleAdjust_Size=-1,this.ParticleRotation_Min=-1,this.ParticleRotation_Max=-1,this.ParticleRotationSpeed_Min=-1,this.ParticleRotationSpeed_Max=-1,this.ParticleStartAlpha_Min=-1,this.ParticleStartAlpha_Max=-1,this.ParticleEndAlpha_Min=-1,this.ParticleEndAlpha_Max=-1,this.ParticleIsSystemPathMode=!1,this.ParticlePathCycle=!1,this.ParticlePathSpeed=-1,this.ParticlePathWaypoints=[],this.ParticleIsEventType=!1,this.ParticleEventTime=[],this.ParticleEventName=[]}return t.prototype.setConfig=function(t){for(var i in t){var e=t[i];null!==e&&""!==e&&i in this!=0&&("number"==typeof e?this[i]=Number(e):this[i]=e)}},t}();t.ParticleSetting=i,__reflect(i.prototype,"RCustom.ParticleSetting")}(RCustom||(RCustom={}));